name: build
description: 'Build the golang binaries'

inputs:
  github-token:
    description: 'Github token to create a release. Optional'

runs:
    using: 'composite'
    steps:
    - name: Setup Golang caches
      uses: actions/cache@v4
      if: "${{ inputs.github-token == '' }}"
      with:
        path: |
          ~/.cache/go-build
          ~/go/pkg/mod
        key: ${{ runner.os }}-golang-${{ hashFiles('**/go.sum') }}

    - name: Build
      uses: goreleaser/goreleaser-action@v6
      if: "${{ inputs.github-token == '' }}"
      with:
        distribution: goreleaser
        version: '~> v2'
        args: build --snapshot

    - name: Build and Release
      uses: goreleaser/goreleaser-action@v6
      if: inputs.github-token
      with:
        distribution: goreleaser
        version: '~> v2'
        args: release --clean
      env:
        GITHUB_TOKEN: ${{ inputs.github-token }}
